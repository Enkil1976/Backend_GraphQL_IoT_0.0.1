
> backend-graphql-iot@1.0.0 start
> node src/server.js

✅ Audit logging service loaded
✅ Two-factor authentication service loaded
✅ Database initialization service loaded
✅ Initialized 10 sensor types
🔍 MQTT Auto-Discovery Service initialized
[WeatherService] WEATHER_API_KEY not configured. Service disabled.
🔐 Encryption service initialized
⚠️ Using generated encryption key - set ENCRYPTION_MASTER_KEY in production
🚀 GraphQL Server ready at http://localhost:4001/graphql
🔗 GraphQL Subscriptions ready at ws://localhost:4001/graphql
🔧 Initializing services...
🔒 Initializing secure database...
🚀 Starting secure database initialization...
🔄 Waiting for database connection...
✅ Redis connected successfully
[WARN] This Redis server's `default` user does not require a password, but a password was supplied
✅ Redis ready
[WARN] This Redis server's `default` user does not require a password, but a password was supplied
[WARN] This Redis server's `default` user does not require a password, but a password was supplied
✅ Database connection established
✅ Schema version table created
🔧 Loaded sensor: temhum2 - TemHum2 - Topic: Invernadero/temhum2/data
🔧 Loaded sensor: luxometro - Luxómetro - Topic: Invernadero/luxometro/data
🔧 Loaded sensor: temhum3 - TemHum3 - Topic: Invernadero/temhum3/data
🔧 Loaded sensor: bmp280-1 - BMP280 Presión - Topic: Invernadero/bmp280-1/data
📡 Loaded 4 active sensors
✅ Audit log database initialized
🚨 Loaded 0 sensor alerts
✅ Dynamic Sensor Service initialized
🔒 Initializing security tables...
⏩ Migration v1001 already applied, skipping
⏩ Migration v1002 already applied, skipping
⏩ Migration v1003 already applied, skipping
⏩ Migration v1004 already applied, skipping
⏩ Migration v1005 already applied, skipping
⏩ Migration v1006 already applied, skipping
⏩ Migration v1007 already applied, skipping
⏩ Migration v1008 already applied, skipping
⏩ Migration v1009 already applied, skipping
⏩ Migration v1010 already applied, skipping
⏩ Migration v1011 already applied, skipping
✅ Dynamic sensor tables initialized
🔧 Enhancing existing tables with security features...
🔍 Verifying database integrity...
📊 Database statistics: 1 users, 5 devices
✅ Database integrity verified
[32minfo[39m: Audit Event {"action":"DATABASE_INITIALIZED","checksum":"f0d161470c3114987d19bac8e6d7204ffe0397a5dc29dd2ecd699a2d9c339b40","client_ip":null,"error_message":null,"event_type":"SYSTEM","metadata":{"process_id":37099,"schema_version":1011,"security_features_enabled":true,"server_time":1752200427097,"tables_count":19},"new_values":null,"old_values":null,"resource_id":null,"resource_type":null,"risk_level":"medium","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:27.096Z","user_agent":null,"user_id":null,"username":null}
🎉 Secure database initialization completed successfully!
✅ Database service initialized
🌡️ Initializing dynamic sensor system...
🔧 Loaded sensor: temhum2 - TemHum2 - Topic: Invernadero/temhum2/data
🔧 Loaded sensor: luxometro - Luxómetro - Topic: Invernadero/luxometro/data
🔧 Loaded sensor: temhum3 - TemHum3 - Topic: Invernadero/temhum3/data
🔧 Loaded sensor: bmp280-1 - BMP280 Presión - Topic: Invernadero/bmp280-1/data
📡 Loaded 4 active sensors
🚨 Loaded 0 sensor alerts
✅ Dynamic Sensor Service initialized
✅ Dynamic sensor system initialized with 10 sensor types
🔌 Connecting to MQTT broker... {
  url: 'mqtts://Backend:11211121@sdb201a6.ala.us-east-1.emqxsl.com:8883',
  clientId: 'mqtt_client_graphql_760feff81544',
  username: 'Backend',
  passwordSet: true
}
✅ MQTT service initialized
🚧 Queue service temporarily disabled for Redis debugging
🚀 Starting rules engine...
🔍 Evaluating 0 active rules...
✅ Rules engine started successfully
✅ Rules engine initialized
🎉 Service initialization completed
✅ MQTT connected successfully
📡 Successfully subscribed to topic: Invernadero/# with QoS 0
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.983Z
   📡 Topic: Invernadero/Agua/Temp
   📄 Payload: 20.6
⚠️ No se encontró sensor para el tópico: Invernadero/Agua/Temp
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.984Z
   📡 Topic: Invernadero/Agua/data
   📄 Payload: {"ph": 5, "ec":1000, "ppm": 1000, "temp": 18 }
⚠️ No se encontró sensor para el tópico: Invernadero/Agua/data
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.984Z
   📡 Topic: Invernadero/Agua/temp
   📄 Payload: {"temp": 18 }
⚠️ No se encontró sensor para el tópico: Invernadero/Agua/temp
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.985Z
   📡 Topic: Invernadero/Bomba/sw
   📄 Payload: {"bombaSw":true }
⚠️ No se encontró sensor para el tópico: Invernadero/Bomba/sw
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.985Z
   📡 Topic: Invernadero/Calefactor/sw
   📄 Payload: {"calefactorSw":true }
⚠️ No se encontró sensor para el tópico: Invernadero/Calefactor/sw
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.985Z
   📡 Topic: Invernadero/CalefactorAgua/sw
   📄 Payload: {"calefactorAguaSw":true }
⚠️ No se encontró sensor para el tópico: Invernadero/CalefactorAgua/sw
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:27.985Z
   📡 Topic: Invernadero/Ventilador/sw
   📄 Payload: {"ventiladorSw":true }
⚠️ No se encontró sensor para el tópico: Invernadero/Ventilador/sw
🔍 No sensor found for topic Invernadero/Agua/Temp, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/Agua/Temp
🔍 No sensor found for topic Invernadero/Agua/data, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/Agua/data
🔍 No sensor found for topic Invernadero/Agua/temp, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/Agua/temp
🔍 No sensor found for topic Invernadero/Bomba/sw, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/Bomba/sw
🔍 No sensor found for topic Invernadero/Calefactor/sw, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/Calefactor/sw
🔍 No sensor found for topic Invernadero/CalefactorAgua/sw, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/CalefactorAgua/sw
🔍 No sensor found for topic Invernadero/Ventilador/sw, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/Ventilador/sw
🆕 Topic Invernadero/Agua/Temp is truly unknown
🆕 Topic Invernadero/Agua/Temp is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/Agua/Temp (1 messages, 1 samples)
📊 Topic Invernadero/Agua/Temp has 1/2 samples
⏳ Topic Invernadero/Agua/Temp needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/Agua/Temp
🆕 Topic Invernadero/Agua/data is truly unknown
🆕 Topic Invernadero/Agua/data is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/Agua/data (1 messages, 1 samples)
📊 Topic Invernadero/Agua/data has 1/2 samples
⏳ Topic Invernadero/Agua/data needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/Agua/data
🆕 Topic Invernadero/Agua/temp is truly unknown
🆕 Topic Invernadero/Agua/temp is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/Agua/temp (1 messages, 1 samples)
📊 Topic Invernadero/Agua/temp has 1/2 samples
⏳ Topic Invernadero/Agua/temp needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/Agua/temp
🆕 Topic Invernadero/Ventilador/sw is truly unknown
🆕 Topic Invernadero/Ventilador/sw is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/Ventilador/sw (1 messages, 1 samples)
📊 Topic Invernadero/Ventilador/sw has 1/2 samples
⏳ Topic Invernadero/Ventilador/sw needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/Ventilador/sw
🆕 Topic Invernadero/CalefactorAgua/sw is truly unknown
🆕 Topic Invernadero/CalefactorAgua/sw is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/CalefactorAgua/sw (1 messages, 1 samples)
📊 Topic Invernadero/CalefactorAgua/sw has 1/2 samples
⏳ Topic Invernadero/CalefactorAgua/sw needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/CalefactorAgua/sw
🆕 Topic Invernadero/Calefactor/sw is truly unknown
🆕 Topic Invernadero/Calefactor/sw is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/Calefactor/sw (1 messages, 1 samples)
📊 Topic Invernadero/Calefactor/sw has 1/2 samples
⏳ Topic Invernadero/Calefactor/sw needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/Calefactor/sw
🆕 Topic Invernadero/Bomba/sw is truly unknown
🆕 Topic Invernadero/Bomba/sw is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/Bomba/sw (1 messages, 1 samples)
📊 Topic Invernadero/Bomba/sw has 1/2 samples
⏳ Topic Invernadero/Bomba/sw needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/Bomba/sw
[32minfo[39m: Audit Event {"action":"HEALTH_CHECK_ACCESS","checksum":"35ba1410811fda3c5aa7795fe99faa5042350f96d97645f0e36cfb23f5d966d6","client_ip":"::ffff:127.0.0.1","error_message":null,"event_type":"SYSTEM","metadata":{"external_ip":"::ffff:127.0.0.1","process_id":37099,"server_time":1752200439338},"new_values":null,"old_values":null,"resource_id":null,"resource_type":null,"risk_level":"medium","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:39.338Z","user_agent":null,"user_id":null,"username":null}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:40.196Z
   📡 Topic: Invernadero/Luxometro/data
   📄 Payload: {"light":1665.331,"white_light":3650,"raw_light":3614}
✅ Sensor encontrado: luxometro (Invernadero/luxometro/data) para tópico: Invernadero/Luxometro/data
🔍 Validando payload para sensor luxometro (LIGHT): {"light":1665.331,"white_light":3650,"raw_light":3614}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor luxometro: {"sensor_type":"LIGHT","payload_keys":["light","white_light","raw_light"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:20:40.198Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "light": 1665.331,
    "white_light": 3650,
    "raw_light": 3614
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:40.198Z
   📡 Topic: Invernadero/TemHum3/data
   📄 Payload: {"temperatura":6.167984,"humedad":64.77594,"rssi":-81}
✅ Sensor encontrado: temhum3 (Invernadero/temhum3/data) para tópico: Invernadero/TemHum3/data
🔍 Validando payload para sensor temhum3 (TEMHUM): {"temperatura":6.167984,"humedad":64.77594,"rssi":-81}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum3: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","rssi"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:20:40.199Z",
  "rssi": -81,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 6.167984,
    "humidity": 64.77594
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:40.200Z
   📡 Topic: Invernadero/BMP280-1/data
   📄 Payload: {"temperatura":7.54,"presion":99247.22}
✅ Sensor encontrado: bmp280-1 (Invernadero/bmp280-1/data) para tópico: Invernadero/BMP280-1/data
🔍 Validando payload para sensor bmp280-1 (TEMP_PRESSURE): {"temperatura":7.54,"presion":99247.22}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor bmp280-1: {"sensor_type":"TEMP_PRESSURE","payload_keys":["temperatura","presion"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:20:40.200Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 7.54,
    "pressure": 99247.22
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 5
📋 Updating cache key: sensor_latest:luxometro
📊 Cache data: {
  "timestamp": "2025-07-11T02:20:40.205Z",
  "sensor_id": 4,
  "hardware_id": "luxometro",
  "sensor_type": "LIGHT",
  "temperatura": null,
  "humedad": null,
  "presion": null,
  "light": 1665.331,
  "white_light": 3650,
  "raw_light": 3614,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "light": 1665.331,
    "white_light": 3650,
    "raw_light": 3614
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:20:40.205Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "light": 1665.331,
      "white_light": 3650,
      "raw_light": 3614
    }
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 7
📋 Updating cache key: sensor_latest:bmp280-1
📊 Cache data: {
  "timestamp": "2025-07-11T02:20:40.206Z",
  "sensor_id": 2,
  "hardware_id": "bmp280-1",
  "sensor_type": "TEMP_PRESSURE",
  "temperatura": 7.54,
  "humedad": null,
  "presion": 99247.22,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 7.54,
    "presion": 99247.22
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:20:40.206Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 7.54,
      "pressure": 99247.22
    }
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 6
📋 Updating cache key: sensor_latest:temhum3
📊 Cache data: {
  "timestamp": "2025-07-11T02:20:40.207Z",
  "sensor_id": 3,
  "hardware_id": "temhum3",
  "sensor_type": "TEMHUM",
  "temperatura": 6.167984,
  "humedad": 64.77594,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": -81,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 6.167984,
    "humedad": 64.77594,
    "rssi": -81
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:20:40.207Z",
    "rssi": -81,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 6.167984,
      "humidity": 64.77594
    }
  }
}
✅ Cache updated for sensor: bmp280-1
✅ Cache updated for sensor: temhum3
✅ Cache updated for sensor: luxometro
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: luxometro
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum3
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: bmp280-1
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:42.125Z
   📡 Topic: Invernadero/TemHum1/data
   📄 Payload: {"temperatura":7.4,"humedad":68.9,"heatindex":6.0,"dewpoint":2.1,"rssi":-79,"boot":49,"mem":19472,"stats":{"tmin":6.5,"tmax":25.5,"tavg":7.5,"hmin":38.0,"hmax":72.9,"havg":68.5,"total":862,"errors":0}...
⚠️ No se encontró sensor para el tópico: Invernadero/TemHum1/data
🔍 No sensor found for topic Invernadero/TemHum1/data, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/TemHum1/data
🆕 Topic Invernadero/TemHum1/data is truly unknown
🆕 Topic Invernadero/TemHum1/data is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/TemHum1/data (1 messages, 1 samples)
📊 Topic Invernadero/TemHum1/data has 1/2 samples
⏳ Topic Invernadero/TemHum1/data needs 1 more samples
🤖 Auto-discovery initiated for topic: Invernadero/TemHum1/data
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:20:42.490Z
   📡 Topic: Invernadero/TemHum2/data
   📄 Payload: {"temperatura":7.8,"humedad":65.2,"heatindex":6.3,"dewpoint":1.7,"rssi":-76,"boot":40,"mem":19472,"stats":{"tmin":7.0,"tmax":25.1,"tavg":8.0,"hmin":36.9,"hmax":70.8,"havg":64.8,"total":861,"errors":0}...
✅ Sensor encontrado: temhum2 (Invernadero/temhum2/data) para tópico: Invernadero/TemHum2/data
🔍 Validando payload para sensor temhum2 (TEMHUM): {"temperatura":7.8,"humedad":65.2,"heatindex":6.3,"dewpoint":1.7,"rssi":-76,"boot":40,"mem":19472,"stats":{"tmin":7,"tmax":25.1,"tavg":8,"hmin":36.9,"hmax":70.8,"havg":64.8,"total":861,"errors":0}}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum2: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","heatindex","dewpoint","rssi","boot","mem","stats"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:20:42.491Z",
  "rssi": -76,
  "boot": 40,
  "mem": 19472,
  "data": {
    "temperature": 7.8,
    "humidity": 65.2,
    "heat_index": 6.3,
    "dew_point": 1.7
  },
  "stats": {
    "tmin": 7,
    "tmax": 25.1,
    "tavg": 8,
    "hmin": 36.9,
    "hmax": 70.8,
    "havg": 64.8,
    "total": 861,
    "errors": 0
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 8
📋 Updating cache key: sensor_latest:temhum2
📊 Cache data: {
  "timestamp": "2025-07-11T02:20:42.497Z",
  "sensor_id": 5,
  "hardware_id": "temhum2",
  "sensor_type": "TEMHUM",
  "temperatura": 7.8,
  "humedad": 65.2,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": 6.3,
  "dewpoint": 1.7,
  "rssi": -76,
  "boot": 40,
  "mem": 19472,
  "_original": {
    "temperatura": 7.8,
    "humedad": 65.2,
    "heatindex": 6.3,
    "dewpoint": 1.7,
    "rssi": -76,
    "boot": 40,
    "mem": 19472,
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 8,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 64.8,
      "total": 861,
      "errors": 0
    }
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:20:42.497Z",
    "rssi": -76,
    "boot": 40,
    "mem": 19472,
    "data": {
      "temperature": 7.8,
      "humidity": 65.2,
      "heat_index": 6.3,
      "dew_point": 1.7
    },
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 8,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 64.8,
      "total": 861,
      "errors": 0
    }
  }
}
✅ Cache updated for sensor: temhum2
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum2
🔍 GraphQL Operation: undefined
[AuthMutation] Login attempt: { username: 'admin' }
[AuthMutation] Login successful: { userId: 1, username: 'admin' }
🔍 GraphQL Operation: undefined
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"abe849e9839edb8e31900c8c4fc742d054c53f6d41ca19595b61a3f002de6301","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447667},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.667Z","user_agent":null,"user_id":1,"username":"admin"}
🔍 GraphQL Operation: undefined
🔍 Consultando datos históricos de todos los sensores...
📊 Parámetros: limit=50, offset=0, from=undefined, to=undefined
🔍 Ejecutando consulta en sensor_data_generic: 
              SELECT id, sensor_id, payload, received_at, 'GENERIC' as sensor_type
              FROM sensor_data_generic
              
              ORDER BY received_at DESC
              LIMIT 50
              OFFSET 0
            
📝 Parámetros: []
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"3da991f93201447d9f573a3cd645f821613dbad8c3f5aef2d2e3841a971bfb54","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447679},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.679Z","user_agent":null,"user_id":1,"username":"admin"}
📊 Resultados de sensor_data_generic: 8 filas
📄 Primera fila: {
  "id": 8,
  "sensor_id": 5,
  "payload": {
    "mem": 19472,
    "boot": 40,
    "data": {
      "humidity": 65.2,
      "dew_point": 1.7,
      "heat_index": 6.3,
      "temperature": 7.8
    },
    "rssi": -76,
    "stats": {
      "havg": 64.8,
      "hmax": 70.8,
      "hmin": 36.9,
      "tavg": 8,
      "tmax": 25.1,
      "tmin": 7,
      "total": 861,
      "errors": 0
    },
    "_metadata": {
      "sensor_id": 5,
      "mqtt_topic": "Invernadero/temhum2/data",
      "hardware_id": "temhum2",
      "sensor_type": "TEMHUM",
      "original_payload": {
        "mem": 19472,
        "boot": 40,
        "rssi": -76,
        "stats": {
          "havg": 64.8,
          "hmax": 70.8,
          "hmin": 36.9,
          "tavg": 8,
          "tmax": 25.1,
          "tmin": 7,
          "total": 861,
          "errors": 0
        },
        "humedad": 65.2,
        "dewpoint": 1.7,
        "heatindex": 6.3,
        "temperatura": 7.8
      }
    },
    "timestamp": "2025-07-11T02:20:42.491Z"
  },
  "received_at": "2025-07-11T02:20:42.491Z",
  "sensor_type": "GENERIC"
}
🔍 Ejecutando consulta en sensor_data_temhum1: 
              SELECT id, 'temhum1' as sensor_id, temperature, humidity, timestamp as received_at, 'TEMHUM1' as sensor_type
              FROM sensor_data_temhum1
              
              ORDER BY received_at DESC
              LIMIT 50
              OFFSET 0
            
📝 Parámetros: []
Database query error: error: relation "sensor_data_temhum1" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async Object.allSensorHistory (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:540:32) {
  length: 119,
  severity: 'ERROR',
  code: '42P01',
  detail: undefined,
  hint: undefined,
  position: '144',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '1381',
  routine: 'parserOpenTable'
}
⚠️ Error consultando tabla sensor_data_temhum1: relation "sensor_data_temhum1" does not exist
🔍 Ejecutando consulta en sensor_data_temhum2: 
              SELECT id, 'temhum2' as sensor_id, temperature, humidity, timestamp as received_at, 'TEMHUM2' as sensor_type
              FROM sensor_data_temhum2
              
              ORDER BY received_at DESC
              LIMIT 50
              OFFSET 0
            
📝 Parámetros: []
Database query error: error: relation "sensor_data_temhum2" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async Object.allSensorHistory (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:540:32) {
  length: 119,
  severity: 'ERROR',
  code: '42P01',
  detail: undefined,
  hint: undefined,
  position: '144',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '1381',
  routine: 'parserOpenTable'
}
⚠️ Error consultando tabla sensor_data_temhum2: relation "sensor_data_temhum2" does not exist
🔍 Ejecutando consulta en sensor_data_calidad_agua: 
              SELECT id, 'calidad_agua' as sensor_id, ph, ec, tds, temperature, timestamp as received_at, 'WATER_QUALITY_LEGACY' as sensor_type
              FROM sensor_data_calidad_agua
              
              ORDER BY received_at DESC
              LIMIT 50
              OFFSET 0
            
📝 Parámetros: []
Database query error: error: relation "sensor_data_calidad_agua" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async Object.allSensorHistory (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:540:32) {
  length: 124,
  severity: 'ERROR',
  code: '42P01',
  detail: undefined,
  hint: undefined,
  position: '165',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '1381',
  routine: 'parserOpenTable'
}
⚠️ Error consultando tabla sensor_data_calidad_agua: relation "sensor_data_calidad_agua" does not exist
🔍 Ejecutando consulta en sensor_data_luxometro: 
              SELECT id, 'luxometro' as sensor_id, lux, timestamp as received_at, 'LIGHT_LEGACY' as sensor_type
              FROM sensor_data_luxometro
              
              ORDER BY received_at DESC
              LIMIT 50
              OFFSET 0
            
📝 Parámetros: []
Database query error: error: relation "sensor_data_luxometro" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async Object.allSensorHistory (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:540:32) {
  length: 121,
  severity: 'ERROR',
  code: '42P01',
  detail: undefined,
  hint: undefined,
  position: '133',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '1381',
  routine: 'parserOpenTable'
}
⚠️ Error consultando tabla sensor_data_luxometro: relation "sensor_data_luxometro" does not exist
📊 Encontrados 8 registros históricos de 1 tipos de sensores
GraphQL Errors: [
  GraphQLError: Enum "SensorType" cannot represent value: "GENERIC"
      at GraphQLEnumType.serialize (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/type/definition.js:1121:13)
      at completeLeafValue (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:757:39)
      at completeValue (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:638:12)
      at completeValue (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:603:23)
      at executeField (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:508:19)
      at executeFields (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:422:22)
      at completeObjectValue (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:933:10)
      at completeValue (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:654:12)
      at completeValue (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:603:23)
      at executeField (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/graphql/execution/execute.js:508:19) {
    path: [ 'allSensorHistory', 'edges', 0, 'node', 'sensorType' ],
    locations: [ [Object] ],
    extensions: [Object: null prototype] {}
  }
]
GraphQL Error: {
  message: 'Enum "SensorType" cannot represent value: "GENERIC"',
  path: [ 'allSensorHistory', 'edges', 0, 'node', 'sensorType' ],
  locations: [ { line: 8, column: 15 } ],
  timestamp: '2025-07-11T02:20:47.703Z',
  stack: undefined
}
🔍 GraphQL Operation: undefined
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"cee614224d2d12dde8f96650aaae215ad25f894dd1d1128a328dd138a60524e2","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447722},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.722Z","user_agent":null,"user_id":1,"username":"admin"}
🔍 Consultando lecturas del sensor 2 (TEMP_PRESSURE)
📊 Hardware ID: bmp280-1, Sensor Type: TEMP_PRESSURE
🔍 Consultando sensor_data_generic para sensor tipo: TEMP_PRESSURE
🔍 Ejecutando consulta genérica: 
        SELECT id, sensor_id, payload, received_at as timestamp
        FROM sensor_data_generic
        WHERE sensor_id = $1
        ORDER BY received_at DESC
        LIMIT $2
        OFFSET $3
      
📝 Parámetros: [ 2, 3, 0 ]
📊 Resultados genéricos: 2 filas
📄 Primera fila: {
  "id": 7,
  "sensor_id": 2,
  "payload": {
    "mem": null,
    "boot": null,
    "data": {
      "pressure": 99247.22,
      "temperature": 7.54
    },
    "rssi": null,
    "_metadata": {
      "sensor_id": 2,
      "mqtt_topic": "Invernadero/bmp280-1/data",
      "hardware_id": "bmp280-1",
      "sensor_type": "TEMP_PRESSURE",
      "original_payload": {
        "presion": 99247.22,
        "temperatura": 7.54
      }
    },
    "timestamp": "2025-07-11T02:20:40.200Z"
  },
  "timestamp": "2025-07-11T02:20:40.200Z"
}
🔍 Raw row data: {
  "id": 7,
  "sensor_id": 2,
  "payload": {
    "mem": null,
    "boot": null,
    "data": {
      "pressure": 99247.22,
      "temperature": 7.54
    },
    "rssi": null,
    "_metadata": {
      "sensor_id": 2,
      "mqtt_topic": "Invernadero/bmp280-1/data",
      "hardware_id": "bmp280-1",
      "sensor_type": "TEMP_PRESSURE",
      "original_payload": {
        "presion": 99247.22,
        "temperatura": 7.54
      }
    },
    "timestamp": "2025-07-11T02:20:40.200Z"
  },
  "timestamp": "2025-07-11T02:20:40.200Z"
}
📊 Datos extraídos: temp=7.54, hum=undefined, pres=99247.22, light=undefined
🔍 Raw row data: {
  "id": 1,
  "sensor_id": 2,
  "payload": {
    "data": {
      "pressure": 99367.2,
      "temperature": 19.95
    },
    "rssi": null,
    "_metadata": {
      "sensor_id": 2,
      "mqtt_topic": "Invernadero/bmp280-1/data",
      "hardware_id": "bmp280-1",
      "sensor_type": "TEMP_PRESSURE"
    },
    "timestamp": "2025-07-11T02:00:00.000Z"
  },
  "timestamp": "2025-07-11T02:20:16.305Z"
}
📊 Datos extraídos: temp=19.95, hum=undefined, pres=99367.2, light=undefined
🔍 GraphQL Operation: undefined
🔍 Consultando lecturas del sensor 3 (TEMHUM)
📊 Hardware ID: temhum3, Sensor Type: TEMHUM
🔍 Consultando sensor_data_generic para sensor tipo: TEMHUM
🔍 Ejecutando consulta genérica: 
        SELECT id, sensor_id, payload, received_at as timestamp
        FROM sensor_data_generic
        WHERE sensor_id = $1
        ORDER BY received_at DESC
        LIMIT $2
        OFFSET $3
      
📝 Parámetros: [ 3, 3, 0 ]
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"1b0ed6ef4ff0f80161a51ddba2664bd3f3ac1a134a07931d3d8f0ba05a52b424","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447776},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.776Z","user_agent":null,"user_id":1,"username":"admin"}
📊 Resultados genéricos: 2 filas
📄 Primera fila: {
  "id": 6,
  "sensor_id": 3,
  "payload": {
    "mem": null,
    "boot": null,
    "data": {
      "humidity": 64.77594,
      "temperature": 6.167984
    },
    "rssi": -81,
    "_metadata": {
      "sensor_id": 3,
      "mqtt_topic": "Invernadero/temhum3/data",
      "hardware_id": "temhum3",
      "sensor_type": "TEMHUM",
      "original_payload": {
        "rssi": -81,
        "humedad": 64.77594,
        "temperatura": 6.167984
      }
    },
    "timestamp": "2025-07-11T02:20:40.199Z"
  },
  "timestamp": "2025-07-11T02:20:40.199Z"
}
🔍 Raw row data: {
  "id": 6,
  "sensor_id": 3,
  "payload": {
    "mem": null,
    "boot": null,
    "data": {
      "humidity": 64.77594,
      "temperature": 6.167984
    },
    "rssi": -81,
    "_metadata": {
      "sensor_id": 3,
      "mqtt_topic": "Invernadero/temhum3/data",
      "hardware_id": "temhum3",
      "sensor_type": "TEMHUM",
      "original_payload": {
        "rssi": -81,
        "humedad": 64.77594,
        "temperatura": 6.167984
      }
    },
    "timestamp": "2025-07-11T02:20:40.199Z"
  },
  "timestamp": "2025-07-11T02:20:40.199Z"
}
📊 Datos extraídos: temp=6.167984, hum=64.77594, pres=undefined, light=undefined
🔍 Raw row data: {
  "id": 2,
  "sensor_id": 3,
  "payload": {
    "data": {
      "humidity": 54.43134,
      "temperature": 18.64834
    },
    "rssi": -84,
    "_metadata": {
      "sensor_id": 3,
      "mqtt_topic": "Invernadero/temhum3/data",
      "hardware_id": "temhum3",
      "sensor_type": "TEMHUM"
    },
    "timestamp": "2025-07-11T02:00:00.000Z"
  },
  "timestamp": "2025-07-11T02:20:16.308Z"
}
📊 Datos extraídos: temp=18.64834, hum=54.43134, pres=undefined, light=undefined
🔍 GraphQL Operation: undefined
🔍 Consultando lecturas del sensor 4 (LIGHT)
📊 Hardware ID: luxometro, Sensor Type: LIGHT
🔍 Consultando sensor_data_generic para sensor tipo: LIGHT
🔍 Ejecutando consulta genérica: 
        SELECT id, sensor_id, payload, received_at as timestamp
        FROM sensor_data_generic
        WHERE sensor_id = $1
        ORDER BY received_at DESC
        LIMIT $2
        OFFSET $3
      
📝 Parámetros: [ 4, 3, 0 ]
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"a34e53f7d6725829066508d1e269e49f3906ba36b566c91423358ca200f94333","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447790},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.790Z","user_agent":null,"user_id":1,"username":"admin"}
📊 Resultados genéricos: 2 filas
📄 Primera fila: {
  "id": 5,
  "sensor_id": 4,
  "payload": {
    "mem": null,
    "boot": null,
    "data": {
      "light": 1665.331,
      "raw_light": 3614,
      "white_light": 3650
    },
    "rssi": null,
    "_metadata": {
      "sensor_id": 4,
      "mqtt_topic": "Invernadero/luxometro/data",
      "hardware_id": "luxometro",
      "sensor_type": "LIGHT",
      "original_payload": {
        "light": 1665.331,
        "raw_light": 3614,
        "white_light": 3650
      }
    },
    "timestamp": "2025-07-11T02:20:40.198Z"
  },
  "timestamp": "2025-07-11T02:20:40.197Z"
}
🔍 Raw row data: {
  "id": 5,
  "sensor_id": 4,
  "payload": {
    "mem": null,
    "boot": null,
    "data": {
      "light": 1665.331,
      "raw_light": 3614,
      "white_light": 3650
    },
    "rssi": null,
    "_metadata": {
      "sensor_id": 4,
      "mqtt_topic": "Invernadero/luxometro/data",
      "hardware_id": "luxometro",
      "sensor_type": "LIGHT",
      "original_payload": {
        "light": 1665.331,
        "raw_light": 3614,
        "white_light": 3650
      }
    },
    "timestamp": "2025-07-11T02:20:40.198Z"
  },
  "timestamp": "2025-07-11T02:20:40.197Z"
}
📊 Datos extraídos: temp=undefined, hum=undefined, pres=undefined, light=1665.331
🔍 Raw row data: {
  "id": 3,
  "sensor_id": 4,
  "payload": {
    "data": {
      "light": 7950.182,
      "raw_light": 17253,
      "white_light": 33905
    },
    "rssi": null,
    "_metadata": {
      "sensor_id": 4,
      "mqtt_topic": "Invernadero/luxometro/data",
      "hardware_id": "luxometro",
      "sensor_type": "LIGHT"
    },
    "timestamp": "2025-07-11T02:00:00.000Z"
  },
  "timestamp": "2025-07-11T02:20:16.310Z"
}
📊 Datos extraídos: temp=undefined, hum=undefined, pres=undefined, light=7950.182
🔍 GraphQL Operation: undefined
🔍 Consultando lecturas del sensor 5 (TEMHUM)
📊 Hardware ID: temhum2, Sensor Type: TEMHUM
🔍 Consultando sensor_data_generic para sensor tipo: TEMHUM
🔍 Ejecutando consulta genérica: 
        SELECT id, sensor_id, payload, received_at as timestamp
        FROM sensor_data_generic
        WHERE sensor_id = $1
        ORDER BY received_at DESC
        LIMIT $2
        OFFSET $3
      
📝 Parámetros: [ 5, 3, 0 ]
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"2ed368f65d91def8a626cee878fe14dc6bd64afc90595cac44fb3bcd856cde55","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447800},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.800Z","user_agent":null,"user_id":1,"username":"admin"}
📊 Resultados genéricos: 2 filas
📄 Primera fila: {
  "id": 8,
  "sensor_id": 5,
  "payload": {
    "mem": 19472,
    "boot": 40,
    "data": {
      "humidity": 65.2,
      "dew_point": 1.7,
      "heat_index": 6.3,
      "temperature": 7.8
    },
    "rssi": -76,
    "stats": {
      "havg": 64.8,
      "hmax": 70.8,
      "hmin": 36.9,
      "tavg": 8,
      "tmax": 25.1,
      "tmin": 7,
      "total": 861,
      "errors": 0
    },
    "_metadata": {
      "sensor_id": 5,
      "mqtt_topic": "Invernadero/temhum2/data",
      "hardware_id": "temhum2",
      "sensor_type": "TEMHUM",
      "original_payload": {
        "mem": 19472,
        "boot": 40,
        "rssi": -76,
        "stats": {
          "havg": 64.8,
          "hmax": 70.8,
          "hmin": 36.9,
          "tavg": 8,
          "tmax": 25.1,
          "tmin": 7,
          "total": 861,
          "errors": 0
        },
        "humedad": 65.2,
        "dewpoint": 1.7,
        "heatindex": 6.3,
        "temperatura": 7.8
      }
    },
    "timestamp": "2025-07-11T02:20:42.491Z"
  },
  "timestamp": "2025-07-11T02:20:42.491Z"
}
🔍 Raw row data: {
  "id": 8,
  "sensor_id": 5,
  "payload": {
    "mem": 19472,
    "boot": 40,
    "data": {
      "humidity": 65.2,
      "dew_point": 1.7,
      "heat_index": 6.3,
      "temperature": 7.8
    },
    "rssi": -76,
    "stats": {
      "havg": 64.8,
      "hmax": 70.8,
      "hmin": 36.9,
      "tavg": 8,
      "tmax": 25.1,
      "tmin": 7,
      "total": 861,
      "errors": 0
    },
    "_metadata": {
      "sensor_id": 5,
      "mqtt_topic": "Invernadero/temhum2/data",
      "hardware_id": "temhum2",
      "sensor_type": "TEMHUM",
      "original_payload": {
        "mem": 19472,
        "boot": 40,
        "rssi": -76,
        "stats": {
          "havg": 64.8,
          "hmax": 70.8,
          "hmin": 36.9,
          "tavg": 8,
          "tmax": 25.1,
          "tmin": 7,
          "total": 861,
          "errors": 0
        },
        "humedad": 65.2,
        "dewpoint": 1.7,
        "heatindex": 6.3,
        "temperatura": 7.8
      }
    },
    "timestamp": "2025-07-11T02:20:42.491Z"
  },
  "timestamp": "2025-07-11T02:20:42.491Z"
}
📊 Datos extraídos: temp=7.8, hum=65.2, pres=undefined, light=undefined
🔍 Raw row data: {
  "id": 4,
  "sensor_id": 5,
  "payload": {
    "data": {
      "humidity": 59,
      "dew_point": 9.3,
      "heat_index": 16.7,
      "temperature": 17.4
    },
    "rssi": -72,
    "_metadata": {
      "sensor_id": 5,
      "mqtt_topic": "Invernadero/temhum2/data",
      "hardware_id": "temhum2",
      "sensor_type": "TEMHUM"
    },
    "timestamp": "2025-07-11T02:00:00.000Z"
  },
  "timestamp": "2025-07-11T02:20:16.311Z"
}
📊 Datos extraídos: temp=17.4, hum=59, pres=undefined, light=undefined
🔍 GraphQL Operation: undefined
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"bcded5a07cbf0466254f2b71cc5ea0353ee1966236e2dae7fdf45d0ba235416d","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447820},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.820Z","user_agent":null,"user_id":1,"username":"admin"}
❌ Error in sensorReadings query: UserInputError: Sensor no encontrado: 6
    at Object.sensorReadings (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:218:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  extensions: { code: 'BAD_USER_INPUT' }
}
GraphQL Errors: [
  UserInputError: Sensor no encontrado: 6
      at Object.sensorReadings (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:218:15)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
    path: [ 'sensorReadings' ],
    locations: [ [Object] ],
    extensions: { code: 'BAD_USER_INPUT' }
  }
]
GraphQL Error: {
  message: 'Sensor no encontrado: 6',
  path: [ 'sensorReadings' ],
  locations: [ { line: 2, column: 11 } ],
  timestamp: '2025-07-11T02:20:47.826Z',
  stack: undefined
}
🔍 GraphQL Operation: undefined
[32minfo[39m: Audit Event {"action":"TOKEN_VERIFIED","checksum":"eaf1a6fabdb1a48ab708d0e58710ea68adca34e6289ba3dace1da815c7fc9215","client_ip":"::1","error_message":null,"event_type":"DATA_ACCESS","metadata":{"process_id":37099,"sensitive_data":false,"server_time":1752200447832},"new_values":null,"old_values":null,"resource_id":1,"resource_type":"authentication","risk_level":"low","service":"iot-audit","session_id":null,"success":true,"timestamp":"2025-07-11T02:20:47.832Z","user_agent":null,"user_id":1,"username":"admin"}
❌ Error in sensorReadings query: UserInputError: Sensor no encontrado: 7
    at Object.sensorReadings (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:218:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  extensions: { code: 'BAD_USER_INPUT' }
}
GraphQL Errors: [
  UserInputError: Sensor no encontrado: 7
      at Object.sensorReadings (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/schema/resolvers/Query/sensors.js:218:15)
      at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
    path: [ 'sensorReadings' ],
    locations: [ [Object] ],
    extensions: { code: 'BAD_USER_INPUT' }
  }
]
GraphQL Error: {
  message: 'Sensor no encontrado: 7',
  path: [ 'sensorReadings' ],
  locations: [ { line: 2, column: 11 } ],
  timestamp: '2025-07-11T02:20:47.839Z',
  stack: undefined
}
🔍 Evaluating 0 active rules...
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:10.150Z
   📡 Topic: Invernadero/Luxometro/data
   📄 Payload: {"light":1665.331,"white_light":3649,"raw_light":3614}
✅ Sensor encontrado: luxometro (Invernadero/luxometro/data) para tópico: Invernadero/Luxometro/data
🔍 Validando payload para sensor luxometro (LIGHT): {"light":1665.331,"white_light":3649,"raw_light":3614}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor luxometro: {"sensor_type":"LIGHT","payload_keys":["light","white_light","raw_light"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:10.151Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "light": 1665.331,
    "white_light": 3649,
    "raw_light": 3614
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:10.152Z
   📡 Topic: Invernadero/TemHum3/data
   📄 Payload: {"temperatura":6.108856,"humedad":65.0486,"rssi":-81}
✅ Sensor encontrado: temhum3 (Invernadero/temhum3/data) para tópico: Invernadero/TemHum3/data
🔍 Validando payload para sensor temhum3 (TEMHUM): {"temperatura":6.108856,"humedad":65.0486,"rssi":-81}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum3: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","rssi"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:10.152Z",
  "rssi": -81,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 6.108856,
    "humidity": 65.0486
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:10.154Z
   📡 Topic: Invernadero/BMP280-1/data
   📄 Payload: {"temperatura":7.48,"presion":99247.23}
✅ Sensor encontrado: bmp280-1 (Invernadero/bmp280-1/data) para tópico: Invernadero/BMP280-1/data
🔍 Validando payload para sensor bmp280-1 (TEMP_PRESSURE): {"temperatura":7.48,"presion":99247.23}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor bmp280-1: {"sensor_type":"TEMP_PRESSURE","payload_keys":["temperatura","presion"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:10.154Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 7.48,
    "pressure": 99247.23
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 9
📋 Updating cache key: sensor_latest:luxometro
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:10.158Z",
  "sensor_id": 4,
  "hardware_id": "luxometro",
  "sensor_type": "LIGHT",
  "temperatura": null,
  "humedad": null,
  "presion": null,
  "light": 1665.331,
  "white_light": 3649,
  "raw_light": 3614,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "light": 1665.331,
    "white_light": 3649,
    "raw_light": 3614
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:10.158Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "light": 1665.331,
      "white_light": 3649,
      "raw_light": 3614
    }
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 10
📋 Updating cache key: sensor_latest:temhum3
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:10.159Z",
  "sensor_id": 3,
  "hardware_id": "temhum3",
  "sensor_type": "TEMHUM",
  "temperatura": 6.108856,
  "humedad": 65.0486,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": -81,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 6.108856,
    "humedad": 65.0486,
    "rssi": -81
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:10.159Z",
    "rssi": -81,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 6.108856,
      "humidity": 65.0486
    }
  }
}
✅ Cache updated for sensor: temhum3
✅ Cache updated for sensor: luxometro
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum3
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: luxometro
✅ Datos almacenados en sensor_data_generic con ID: 11
📋 Updating cache key: sensor_latest:bmp280-1
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:10.175Z",
  "sensor_id": 2,
  "hardware_id": "bmp280-1",
  "sensor_type": "TEMP_PRESSURE",
  "temperatura": 7.48,
  "humedad": null,
  "presion": 99247.23,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 7.48,
    "presion": 99247.23
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:10.175Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 7.48,
      "pressure": 99247.23
    }
  }
}
✅ Cache updated for sensor: bmp280-1
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: bmp280-1
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:12.511Z
   📡 Topic: Invernadero/TemHum1/data
   📄 Payload: {"temperatura":7.3,"humedad":69.1,"heatindex":5.9,"dewpoint":2.0,"rssi":-77,"boot":49,"mem":19472,"stats":{"tmin":6.5,"tmax":25.5,"tavg":7.5,"hmin":38.0,"hmax":72.9,"havg":68.7,"total":863,"errors":0}...
⚠️ No se encontró sensor para el tópico: Invernadero/TemHum1/data
🔍 No sensor found for topic Invernadero/TemHum1/data, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/TemHum1/data
🆕 Topic Invernadero/TemHum1/data is truly unknown
🆕 Topic Invernadero/TemHum1/data is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/TemHum1/data (2 messages, 2 samples)
✅ Topic Invernadero/TemHum1/data reached minimum samples (2), ready for analysis!
📊 Topic Invernadero/TemHum1/data has 2/2 samples
🚀 Analyzing topic Invernadero/TemHum1/data (threshold reached)
🤖 Analysis for Invernadero/TemHum1/data: {
  sensorScore: 100,
  deviceScore: 0,
  suggestedType: 'sensor',
  confidence: 100
}
🤖 Creating auto-sensor: TemHum1 - Temperatura y Humedad (Auto) (TEMHUM)
Database query error: error: duplicate key value violates unique constraint "sensors_pkey"
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:760:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 186,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (id)=(2) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: undefined,
  dataType: undefined,
  constraint: 'sensors_pkey',
  file: 'nbtinsert.c',
  line: '663',
  routine: '_bt_check_unique'
}
🔄 Fallback: Creating sensor without mqtt_topic first
Database query error: error: null value in column "mqtt_topic" of relation "sensors" violates not-null constraint
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:780:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 418,
  severity: 'ERROR',
  code: '23502',
  detail: 'Failing row contains (3, TemHum1 - Temperatura y Humedad (Auto), TEMHUM, invernadero-temhum1, null, Auto-detected, Auto-created from MQTT topic: Invernadero/TemHum1/data, {}, t, 2025-07-11 02:21:12.549596+00, 2025-07-11 02:21:12.549596+00).',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: 'mqtt_topic',
  dataType: undefined,
  constraint: undefined,
  file: 'execMain.c',
  line: '1887',
  routine: 'ExecConstraints'
}
❌ Error creating auto-sensor for Invernadero/TemHum1/data: error: null value in column "mqtt_topic" of relation "sensors" violates not-null constraint
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:780:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 418,
  severity: 'ERROR',
  code: '23502',
  detail: 'Failing row contains (3, TemHum1 - Temperatura y Humedad (Auto), TEMHUM, invernadero-temhum1, null, Auto-detected, Auto-created from MQTT topic: Invernadero/TemHum1/data, {}, t, 2025-07-11 02:21:12.549596+00, 2025-07-11 02:21:12.549596+00).',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: 'mqtt_topic',
  dataType: undefined,
  constraint: undefined,
  file: 'execMain.c',
  line: '1887',
  routine: 'ExecConstraints'
}
❌ Error analyzing topic Invernadero/TemHum1/data: error: null value in column "mqtt_topic" of relation "sensors" violates not-null constraint
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:780:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 418,
  severity: 'ERROR',
  code: '23502',
  detail: 'Failing row contains (3, TemHum1 - Temperatura y Humedad (Auto), TEMHUM, invernadero-temhum1, null, Auto-detected, Auto-created from MQTT topic: Invernadero/TemHum1/data, {}, t, 2025-07-11 02:21:12.549596+00, 2025-07-11 02:21:12.549596+00).',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: 'mqtt_topic',
  dataType: undefined,
  constraint: undefined,
  file: 'execMain.c',
  line: '1887',
  routine: 'ExecConstraints'
}
🤖 Auto-discovery initiated for topic: Invernadero/TemHum1/data
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:12.978Z
   📡 Topic: Invernadero/TemHum2/data
   📄 Payload: {"temperatura":7.6,"humedad":65.4,"heatindex":6.1,"dewpoint":1.5,"rssi":-74,"boot":40,"mem":19472,"stats":{"tmin":7.0,"tmax":25.1,"tavg":7.9,"hmin":36.9,"hmax":70.8,"havg":65.0,"total":862,"errors":0}...
✅ Sensor encontrado: temhum2 (Invernadero/temhum2/data) para tópico: Invernadero/TemHum2/data
🔍 Validando payload para sensor temhum2 (TEMHUM): {"temperatura":7.6,"humedad":65.4,"heatindex":6.1,"dewpoint":1.5,"rssi":-74,"boot":40,"mem":19472,"stats":{"tmin":7,"tmax":25.1,"tavg":7.9,"hmin":36.9,"hmax":70.8,"havg":65,"total":862,"errors":0}}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum2: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","heatindex","dewpoint","rssi","boot","mem","stats"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:12.978Z",
  "rssi": -74,
  "boot": 40,
  "mem": 19472,
  "data": {
    "temperature": 7.6,
    "humidity": 65.4,
    "heat_index": 6.1,
    "dew_point": 1.5
  },
  "stats": {
    "tmin": 7,
    "tmax": 25.1,
    "tavg": 7.9,
    "hmin": 36.9,
    "hmax": 70.8,
    "havg": 65,
    "total": 862,
    "errors": 0
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 12
📋 Updating cache key: sensor_latest:temhum2
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:13.000Z",
  "sensor_id": 5,
  "hardware_id": "temhum2",
  "sensor_type": "TEMHUM",
  "temperatura": 7.6,
  "humedad": 65.4,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": 6.1,
  "dewpoint": 1.5,
  "rssi": -74,
  "boot": 40,
  "mem": 19472,
  "_original": {
    "temperatura": 7.6,
    "humedad": 65.4,
    "heatindex": 6.1,
    "dewpoint": 1.5,
    "rssi": -74,
    "boot": 40,
    "mem": 19472,
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 7.9,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 65,
      "total": 862,
      "errors": 0
    }
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:13.000Z",
    "rssi": -74,
    "boot": 40,
    "mem": 19472,
    "data": {
      "temperature": 7.6,
      "humidity": 65.4,
      "heat_index": 6.1,
      "dew_point": 1.5
    },
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 7.9,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 65,
      "total": 862,
      "errors": 0
    }
  }
}
✅ Cache updated for sensor: temhum2
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum2
🔍 Evaluating 0 active rules...
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:40.205Z
   📡 Topic: Invernadero/Luxometro/data
   📄 Payload: {"light":1665.331,"white_light":3650,"raw_light":3614}
✅ Sensor encontrado: luxometro (Invernadero/luxometro/data) para tópico: Invernadero/Luxometro/data
🔍 Validando payload para sensor luxometro (LIGHT): {"light":1665.331,"white_light":3650,"raw_light":3614}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor luxometro: {"sensor_type":"LIGHT","payload_keys":["light","white_light","raw_light"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:40.206Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "light": 1665.331,
    "white_light": 3650,
    "raw_light": 3614
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:40.211Z
   📡 Topic: Invernadero/TemHum3/data
   📄 Payload: {"temperatura":6.035233,"humedad":65.28635,"rssi":-82}
✅ Sensor encontrado: temhum3 (Invernadero/temhum3/data) para tópico: Invernadero/TemHum3/data
🔍 Validando payload para sensor temhum3 (TEMHUM): {"temperatura":6.035233,"humedad":65.28635,"rssi":-82}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum3: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","rssi"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:40.211Z",
  "rssi": -82,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 6.035233,
    "humidity": 65.28635
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:40.212Z
   📡 Topic: Invernadero/BMP280-1/data
   📄 Payload: {"temperatura":7.41,"presion":99248.2}
✅ Sensor encontrado: bmp280-1 (Invernadero/bmp280-1/data) para tópico: Invernadero/BMP280-1/data
🔍 Validando payload para sensor bmp280-1 (TEMP_PRESSURE): {"temperatura":7.41,"presion":99248.2}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor bmp280-1: {"sensor_type":"TEMP_PRESSURE","payload_keys":["temperatura","presion"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:40.212Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 7.41,
    "pressure": 99248.2
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 13
📋 Updating cache key: sensor_latest:luxometro
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:40.212Z",
  "sensor_id": 4,
  "hardware_id": "luxometro",
  "sensor_type": "LIGHT",
  "temperatura": null,
  "humedad": null,
  "presion": null,
  "light": 1665.331,
  "white_light": 3650,
  "raw_light": 3614,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "light": 1665.331,
    "white_light": 3650,
    "raw_light": 3614
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:40.212Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "light": 1665.331,
      "white_light": 3650,
      "raw_light": 3614
    }
  }
}
✅ Cache updated for sensor: luxometro
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: luxometro
✅ Datos almacenados en sensor_data_generic con ID: 14
📋 Updating cache key: sensor_latest:bmp280-1
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:40.230Z",
  "sensor_id": 2,
  "hardware_id": "bmp280-1",
  "sensor_type": "TEMP_PRESSURE",
  "temperatura": 7.41,
  "humedad": null,
  "presion": 99248.2,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 7.41,
    "presion": 99248.2
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:40.230Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 7.41,
      "pressure": 99248.2
    }
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 15
📋 Updating cache key: sensor_latest:temhum3
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:40.232Z",
  "sensor_id": 3,
  "hardware_id": "temhum3",
  "sensor_type": "TEMHUM",
  "temperatura": 6.035233,
  "humedad": 65.28635,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": -82,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 6.035233,
    "humedad": 65.28635,
    "rssi": -82
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:40.232Z",
    "rssi": -82,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 6.035233,
      "humidity": 65.28635
    }
  }
}
✅ Cache updated for sensor: bmp280-1
✅ Cache updated for sensor: temhum3
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: bmp280-1
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum3
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:43.026Z
   📡 Topic: Invernadero/TemHum1/data
   📄 Payload: {"temperatura":7.1,"humedad":69.3,"heatindex":5.7,"dewpoint":1.9,"rssi":-78,"boot":49,"mem":19472,"stats":{"tmin":6.5,"tmax":25.5,"tavg":7.4,"hmin":38.0,"hmax":72.9,"havg":68.9,"total":864,"errors":0}...
⚠️ No se encontró sensor para el tópico: Invernadero/TemHum1/data
🔍 No sensor found for topic Invernadero/TemHum1/data, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/TemHum1/data
🆕 Topic Invernadero/TemHum1/data is truly unknown
🆕 Topic Invernadero/TemHum1/data is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/TemHum1/data (3 messages, 3 samples)
📊 Topic Invernadero/TemHum1/data has 3/2 samples
🚀 Analyzing topic Invernadero/TemHum1/data (threshold reached)
🤖 Analysis for Invernadero/TemHum1/data: {
  sensorScore: 99.99999999999999,
  deviceScore: 0,
  suggestedType: 'sensor',
  confidence: 99.99999999999999
}
🤖 Creating auto-sensor: TemHum1 - Temperatura y Humedad (Auto) (TEMHUM)
Database query error: error: duplicate key value violates unique constraint "sensors_pkey"
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:760:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 186,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (id)=(4) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: undefined,
  dataType: undefined,
  constraint: 'sensors_pkey',
  file: 'nbtinsert.c',
  line: '663',
  routine: '_bt_check_unique'
}
🔄 Fallback: Creating sensor without mqtt_topic first
Database query error: error: null value in column "mqtt_topic" of relation "sensors" violates not-null constraint
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:780:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 418,
  severity: 'ERROR',
  code: '23502',
  detail: 'Failing row contains (5, TemHum1 - Temperatura y Humedad (Auto), TEMHUM, invernadero-temhum1, null, Auto-detected, Auto-created from MQTT topic: Invernadero/TemHum1/data, {}, t, 2025-07-11 02:21:43.010564+00, 2025-07-11 02:21:43.010564+00).',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: 'mqtt_topic',
  dataType: undefined,
  constraint: undefined,
  file: 'execMain.c',
  line: '1887',
  routine: 'ExecConstraints'
}
❌ Error creating auto-sensor for Invernadero/TemHum1/data: error: null value in column "mqtt_topic" of relation "sensors" violates not-null constraint
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:780:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 418,
  severity: 'ERROR',
  code: '23502',
  detail: 'Failing row contains (5, TemHum1 - Temperatura y Humedad (Auto), TEMHUM, invernadero-temhum1, null, Auto-detected, Auto-created from MQTT topic: Invernadero/TemHum1/data, {}, t, 2025-07-11 02:21:43.010564+00, 2025-07-11 02:21:43.010564+00).',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: 'mqtt_topic',
  dataType: undefined,
  constraint: undefined,
  file: 'execMain.c',
  line: '1887',
  routine: 'ExecConstraints'
}
❌ Error analyzing topic Invernadero/TemHum1/data: error: null value in column "mqtt_topic" of relation "sensors" violates not-null constraint
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async MQTTAutoDiscoveryService.createSensorInternal (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:780:22)
    at async MQTTAutoDiscoveryService.createAutoSensor (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:588:22)
    at async MQTTAutoDiscoveryService.analyzeAndCreate (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:384:11)
    at async MQTTAutoDiscoveryService.processUnknownMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttAutoDiscoveryService.js:224:9)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:147:29) {
  length: 418,
  severity: 'ERROR',
  code: '23502',
  detail: 'Failing row contains (5, TemHum1 - Temperatura y Humedad (Auto), TEMHUM, invernadero-temhum1, null, Auto-detected, Auto-created from MQTT topic: Invernadero/TemHum1/data, {}, t, 2025-07-11 02:21:43.010564+00, 2025-07-11 02:21:43.010564+00).',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'sensors',
  column: 'mqtt_topic',
  dataType: undefined,
  constraint: undefined,
  file: 'execMain.c',
  line: '1887',
  routine: 'ExecConstraints'
}
🤖 Auto-discovery initiated for topic: Invernadero/TemHum1/data
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:21:43.364Z
   📡 Topic: Invernadero/TemHum2/data
   📄 Payload: {"temperatura":7.5,"humedad":65.7,"heatindex":6.0,"dewpoint":1.5,"rssi":-76,"boot":40,"mem":19472,"stats":{"tmin":7.0,"tmax":25.1,"tavg":7.8,"hmin":36.9,"hmax":70.8,"havg":65.2,"total":863,"errors":0}...
✅ Sensor encontrado: temhum2 (Invernadero/temhum2/data) para tópico: Invernadero/TemHum2/data
🔍 Validando payload para sensor temhum2 (TEMHUM): {"temperatura":7.5,"humedad":65.7,"heatindex":6,"dewpoint":1.5,"rssi":-76,"boot":40,"mem":19472,"stats":{"tmin":7,"tmax":25.1,"tavg":7.8,"hmin":36.9,"hmax":70.8,"havg":65.2,"total":863,"errors":0}}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum2: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","heatindex","dewpoint","rssi","boot","mem","stats"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:21:43.365Z",
  "rssi": -76,
  "boot": 40,
  "mem": 19472,
  "data": {
    "temperature": 7.5,
    "humidity": 65.7,
    "heat_index": 6,
    "dew_point": 1.5
  },
  "stats": {
    "tmin": 7,
    "tmax": 25.1,
    "tavg": 7.8,
    "hmin": 36.9,
    "hmax": 70.8,
    "havg": 65.2,
    "total": 863,
    "errors": 0
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 16
📋 Updating cache key: sensor_latest:temhum2
📊 Cache data: {
  "timestamp": "2025-07-11T02:21:43.387Z",
  "sensor_id": 5,
  "hardware_id": "temhum2",
  "sensor_type": "TEMHUM",
  "temperatura": 7.5,
  "humedad": 65.7,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": 6,
  "dewpoint": 1.5,
  "rssi": -76,
  "boot": 40,
  "mem": 19472,
  "_original": {
    "temperatura": 7.5,
    "humedad": 65.7,
    "heatindex": 6,
    "dewpoint": 1.5,
    "rssi": -76,
    "boot": 40,
    "mem": 19472,
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 7.8,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 65.2,
      "total": 863,
      "errors": 0
    }
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:21:43.387Z",
    "rssi": -76,
    "boot": 40,
    "mem": 19472,
    "data": {
      "temperature": 7.5,
      "humidity": 65.7,
      "heat_index": 6,
      "dew_point": 1.5
    },
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 7.8,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 65.2,
      "total": 863,
      "errors": 0
    }
  }
}
✅ Cache updated for sensor: temhum2
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum2
🔍 Evaluating 0 active rules...
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:22:10.271Z
   📡 Topic: Invernadero/Luxometro/data
   📄 Payload: {"light":1665.331,"white_light":3649,"raw_light":3614}
✅ Sensor encontrado: luxometro (Invernadero/luxometro/data) para tópico: Invernadero/Luxometro/data
🔍 Validando payload para sensor luxometro (LIGHT): {"light":1665.331,"white_light":3649,"raw_light":3614}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor luxometro: {"sensor_type":"LIGHT","payload_keys":["light","white_light","raw_light"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:22:10.271Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "light": 1665.331,
    "white_light": 3649,
    "raw_light": 3614
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 17
📋 Updating cache key: sensor_latest:luxometro
📊 Cache data: {
  "timestamp": "2025-07-11T02:22:10.279Z",
  "sensor_id": 4,
  "hardware_id": "luxometro",
  "sensor_type": "LIGHT",
  "temperatura": null,
  "humedad": null,
  "presion": null,
  "light": 1665.331,
  "white_light": 3649,
  "raw_light": 3614,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "light": 1665.331,
    "white_light": 3649,
    "raw_light": 3614
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:22:10.279Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "light": 1665.331,
      "white_light": 3649,
      "raw_light": 3614
    }
  }
}
✅ Cache updated for sensor: luxometro
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: luxometro
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:22:10.389Z
   📡 Topic: Invernadero/TemHum3/data
   📄 Payload: {"temperatura":5.875969,"humedad":65.45419,"rssi":-82}
✅ Sensor encontrado: temhum3 (Invernadero/temhum3/data) para tópico: Invernadero/TemHum3/data
🔍 Validando payload para sensor temhum3 (TEMHUM): {"temperatura":5.875969,"humedad":65.45419,"rssi":-82}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum3: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","rssi"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:22:10.390Z",
  "rssi": -82,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 5.875969,
    "humidity": 65.45419
  }
}
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:22:10.390Z
   📡 Topic: Invernadero/BMP280-1/data
   📄 Payload: {"temperatura":7.28,"presion":99249.66}
✅ Sensor encontrado: bmp280-1 (Invernadero/bmp280-1/data) para tópico: Invernadero/BMP280-1/data
🔍 Validando payload para sensor bmp280-1 (TEMP_PRESSURE): {"temperatura":7.28,"presion":99249.66}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor bmp280-1: {"sensor_type":"TEMP_PRESSURE","payload_keys":["temperatura","presion"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:22:10.391Z",
  "rssi": null,
  "boot": null,
  "mem": null,
  "data": {
    "temperature": 7.28,
    "pressure": 99249.66
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 19
📋 Updating cache key: sensor_latest:bmp280-1
📊 Cache data: {
  "timestamp": "2025-07-11T02:22:10.410Z",
  "sensor_id": 2,
  "hardware_id": "bmp280-1",
  "sensor_type": "TEMP_PRESSURE",
  "temperatura": 7.28,
  "humedad": null,
  "presion": 99249.66,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": null,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 7.28,
    "presion": 99249.66
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:22:10.410Z",
    "rssi": null,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 7.28,
      "pressure": 99249.66
    }
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 18
📋 Updating cache key: sensor_latest:temhum3
📊 Cache data: {
  "timestamp": "2025-07-11T02:22:10.411Z",
  "sensor_id": 3,
  "hardware_id": "temhum3",
  "sensor_type": "TEMHUM",
  "temperatura": 5.875969,
  "humedad": 65.45419,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": null,
  "dewpoint": null,
  "rssi": -82,
  "boot": null,
  "mem": null,
  "_original": {
    "temperatura": 5.875969,
    "humedad": 65.45419,
    "rssi": -82
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:22:10.411Z",
    "rssi": -82,
    "boot": null,
    "mem": null,
    "data": {
      "temperature": 5.875969,
      "humidity": 65.45419
    }
  }
}
✅ Cache updated for sensor: bmp280-1
✅ Cache updated for sensor: temhum3
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum3
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: bmp280-1
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:22:13.325Z
   📡 Topic: Invernadero/TemHum1/data
   📄 Payload: {"temperatura":7.0,"humedad":69.6,"heatindex":5.6,"dewpoint":1.8,"rssi":-77,"boot":49,"mem":19472,"stats":{"tmin":6.5,"tmax":25.5,"tavg":7.2,"hmin":38.0,"hmax":72.9,"havg":69.1,"total":865,"errors":0}...
⚠️ No se encontró sensor para el tópico: Invernadero/TemHum1/data
🔍 No sensor found for topic Invernadero/TemHum1/data, attempting auto-discovery...
🔍 Processing unknown message for topic: Invernadero/TemHum1/data
🆕 Topic Invernadero/TemHum1/data is truly unknown
🆕 Topic Invernadero/TemHum1/data is unknown, adding to analysis queue
🔍 Unknown topic: Invernadero/TemHum1/data (4 messages, 4 samples)
📊 Topic Invernadero/TemHum1/data has 4/2 samples
🚀 Analyzing topic Invernadero/TemHum1/data (threshold reached)
🤖 Analysis for Invernadero/TemHum1/data: {
  sensorScore: 100,
  deviceScore: 0,
  suggestedType: 'sensor',
  confidence: 100
}
🤖 Creating auto-sensor: TemHum1 - Temperatura y Humedad (Auto) (TEMHUM)
✅ Auto-created sensor: TemHum1 - Temperatura y Humedad (Auto) (ID: 6)
🤖 Auto-discovery initiated for topic: Invernadero/TemHum1/data
🚀 MQTT MESSAGE PROCESSING STARTED
   🕰️ Timestamp: 2025-07-11T02:22:13.746Z
   📡 Topic: Invernadero/TemHum2/data
   📄 Payload: {"temperatura":7.5,"humedad":66.0,"heatindex":6.0,"dewpoint":1.6,"rssi":-75,"boot":40,"mem":19472,"stats":{"tmin":7.0,"tmax":25.1,"tavg":7.7,"hmin":36.9,"hmax":70.8,"havg":65.4,"total":864,"errors":0}...
✅ Sensor encontrado: temhum2 (Invernadero/temhum2/data) para tópico: Invernadero/TemHum2/data
🔍 Validando payload para sensor temhum2 (TEMHUM): {"temperatura":7.5,"humedad":66,"heatindex":6,"dewpoint":1.6,"rssi":-75,"boot":40,"mem":19472,"stats":{"tmin":7,"tmax":25.1,"tavg":7.7,"hmin":36.9,"hmax":70.8,"havg":65.4,"total":864,"errors":0}}
🔍 Resultado de validación: {"valid":true}
🔍 Procesando datos para sensor temhum2: {"sensor_type":"TEMHUM","payload_keys":["temperatura","humedad","heatindex","dewpoint","rssi","boot","mem","stats"]}
🔍 Usando tabla genérica: sensor_data_generic
📊 Payload normalizado: {
  "timestamp": "2025-07-11T02:22:13.746Z",
  "rssi": -75,
  "boot": 40,
  "mem": 19472,
  "data": {
    "temperature": 7.5,
    "humidity": 66,
    "heat_index": 6,
    "dew_point": 1.6
  },
  "stats": {
    "tmin": 7,
    "tmax": 25.1,
    "tavg": 7.7,
    "hmin": 36.9,
    "hmax": 70.8,
    "havg": 65.4,
    "total": 864,
    "errors": 0
  }
}
✅ Datos almacenados en sensor_data_generic con ID: 20
📋 Updating cache key: sensor_latest:temhum2
📊 Cache data: {
  "timestamp": "2025-07-11T02:22:13.753Z",
  "sensor_id": 5,
  "hardware_id": "temhum2",
  "sensor_type": "TEMHUM",
  "temperatura": 7.5,
  "humedad": 66,
  "presion": null,
  "light": null,
  "white_light": null,
  "raw_light": null,
  "heatindex": 6,
  "dewpoint": 1.6,
  "rssi": -75,
  "boot": 40,
  "mem": 19472,
  "_original": {
    "temperatura": 7.5,
    "humedad": 66,
    "heatindex": 6,
    "dewpoint": 1.6,
    "rssi": -75,
    "boot": 40,
    "mem": 19472,
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 7.7,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 65.4,
      "total": 864,
      "errors": 0
    }
  },
  "_normalized": {
    "timestamp": "2025-07-11T02:22:13.753Z",
    "rssi": -75,
    "boot": 40,
    "mem": 19472,
    "data": {
      "temperature": 7.5,
      "humidity": 66,
      "heat_index": 6,
      "dew_point": 1.6
    },
    "stats": {
      "tmin": 7,
      "tmax": 25.1,
      "tavg": 7.7,
      "hmin": 36.9,
      "hmax": 70.8,
      "havg": 65.4,
      "total": 864,
      "errors": 0
    }
  }
}
✅ Cache updated for sensor: temhum2
Database query error: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
❌ Error updating sensor online status: error: column "is_online" of relation "sensors" does not exist
    at /Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async query (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/config/database.js:79:20)
    at async DynamicSensorService.updateSensorOnlineStatus (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:766:7)
    at async DynamicSensorService.processSensorData (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/dynamicSensorService.js:441:7)
    at async MqttService.handleIncomingMessage (/Users/marcelosalcedo/BakendFull/Backend_GraphQL_IoT/src/services/mqttService.js:142:25) {
  length: 131,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '20',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'analyze.c',
  line: '2469',
  routine: 'transformUpdateTargetList'
}
✅ Datos procesados para sensor: temhum2
📡 SIGTERM received, shutting down gracefully...
🛑 Shutting down GraphQL server...
✅ WebSocket server stopped
✅ Apollo server stopped
✅ HTTP server stopped
🛑 Shutting down services...
🛑 Stopping rules engine...
✅ Rules engine stopped
✅ Rules engine stopped
⚡ Queue processor is not running
✅ Queue service stopped
🔌 Disconnecting from MQTT broker...
✅ MQTT service disconnected
✅ PubSub closed
🎉 All services shut down successfully
✅ GraphQL server shutdown complete
